<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <title>Notre douce maison</title>
  <style>
    body, html {
      margin: 0; padding: 0; height: 100%;
      font-family: 'Cursive', serif; overflow: hidden;
    }
    .background {
      position: fixed; top: 0; left: 0;
      width: 100%; height: 100%; z-index: -1; overflow: hidden;
    }
    .background img {
      position: absolute; inset: 0;
      width: 100%; height: 100%;
      object-fit: cover; opacity: 0; transition: opacity 3s ease-in-out;
    }
    .active { opacity: 1; }

    .page {
      display: flex; justify-content: center; align-items: center;
      height: 100%; width: 100%; text-align: center;
      font-size: 3rem; color: white; background: rgba(0,0,0,0.4);
      transition: opacity 2s;
    }
    .hidden { display: none; }

    .enigme { font-family: 'Brush Script MT', cursive; font-size: 3.5rem; margin-bottom: 40px; }
    input { padding: 25px; font-size: 2rem; margin-bottom: 30px; text-align: center; }
    button { padding: 20px 50px; margin-left: 10px; font-size: 2rem; cursor: pointer; }
    .fade-out { opacity: 0; transition: opacity 5s ease; }

    .swiper { width: 100%; height: 100%; }
    .swiper-slide {
      display: flex; justify-content: center; align-items: center;
      text-align: center; color: white; background: rgba(0,0,0,0.4); font-size: 2rem;
    }
    .swiper-slide > div {
      display: flex; flex-direction: column; justify-content: center; align-items: center;
      height: 100%; width: 100%;
    }

    /* Slide finale = fond noir plein, pas d'images derrière */
    .final-slide { background: black !important; }

    /* Écran noir de transition */
    #blackout {
      position: fixed; top:0; left:0; width:100%; height:100%;
      background:black; opacity:0; pointer-events:none;
      transition: opacity 5s ease; z-index: 9999;
    }
  </style>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.css" />
</head>
<body>
  <div class="background"></div>
  <div id="blackout"></div>

  <div id="accueil" class="page">
    <h1>Notre douce maison4</h1>
  </div>

  <div class="swiper hidden" id="enigmes">
    <div class="swiper-wrapper" id="swiper-wrapper"></div>
    <div class="swiper-pagination"></div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.js"></script>
  <script>
    // === Config images ===
    const bgContainer = document.querySelector('.background');
    const baseURL = "https://thesamestoy.github.io/homesweethome/images/";
    const specialFourthURL = "https://thesamestoy.github.io/homesweethome/panneaux3.jpg";

    // Liste pour le diaporama (a.jpg -> w.jpg)
    const letters = "abcdefghijklmnopqrstuvw";
    const slideshowImages = letters.split('').map(l => baseURL + l + ".jpg");

    // === État global ===
    let slideshowInterval = null; // contrôler le diaporama
    let swiper;                   // l'instance Swiper
    let finalCreated = false;     // éviter de créer 2 fois la finale

    // Deux calques d'image pour le crossfade
    let img1 = document.createElement('img');
    let img2 = document.createElement('img');
    let currentIndex = 0;

    // Ajouter immédiatement les calques au DOM (pas d'Accueil.jpg)
    bgContainer.appendChild(img1);
    bgContainer.appendChild(img2);

    // Utilitaires diaporama
    function stopSlideshow() {
      if (slideshowInterval) {
        clearInterval(slideshowInterval);
        slideshowInterval = null;
      }
    }
    function startSlideshow() {
      if (!img1 || !img2 || slideshowImages.length === 0) return;
      stopSlideshow();
      // si aucune image active, activer img1 sur l'index courant
      if (!img1.src) {
        currentIndex = Math.floor(Math.random() * slideshowImages.length);
        img1.src = slideshowImages[currentIndex];
        img1.classList.add("active");
        img2.classList.remove("active");
      }
      slideshowInterval = setInterval(() => {
        let nextIndex;
        do { nextIndex = Math.floor(Math.random() * slideshowImages.length); }
        while (nextIndex === currentIndex);
        currentIndex = nextIndex;

        img2.src = slideshowImages[currentIndex];
        img2.classList.add("active");
        img1.classList.remove("active");

        const tmp = img1; img1 = img2; img2 = tmp;
      }, 5000);
    }
    function setStaticBackground(url) {
      if (!img1 || !img2) return;
      stopSlideshow();
      img1.src = url;
      img2.src = url;
      img1.classList.add("active");
      img2.classList.remove("active");
    }

    // DÉMARRER LE FOND TOUT DE SUITE (plus de dépendance à Accueil.jpg)
    currentIndex = Math.floor(Math.random() * slideshowImages.length);
    img1.src = slideshowImages[currentIndex];
    img1.classList.add("active");
    startSlideshow();

    // Afficher les énigmes après l'écran d'accueil (mêmes timings que ton code)
    setTimeout(() => {
      document.getElementById('accueil').style.opacity = 0;
      setTimeout(() => {
        document.getElementById('accueil').classList.add('hidden');
        document.getElementById('enigmes').classList.remove('hidden');
      }, 2000);
    }, 5000);

    // === Données des 10 énigmes ===
    const data = [
      { question: "Sans être délice<br>je ne suis pas laid<br>retrouvez moi six fois<br>autour d'un café", reponse: 'Lait' },
      { question: "<span style='color:red; text-decoration: line-through;'>356</span> - 47 - 007 - 701<br>Nous sommes premiers<br>mais le dernier ne l'est pas<br>qui est-il ?", reponse: 'Zéro' },
      { question: "Contre vents et marées<br>Et vos milles averses<br>Je suis l'inamovible guide<br>The silent partner", reponse: 'Phare' },
      { question: "La première flèche indique l'entrée<br>Et la seconde ?", reponse: 'Thonier' }, // 4e énigme
      { question: "Fuyez nemesis<br>résolvez le puzzle<br>H470-H485-H490-H580-H600<br>connait le chemin", reponse: 'Balance' },
      { question: "Exotique gardien<br>je veille au brin du jour<br>l'Enigma enfantin<br>27 lettres d'amour", reponse: 'Toucan' },
      { question: "Trouvez l'équation<br>et faites que s'illumine<br>non pas 3x<br> mais le chiffre solution", reponse: 'Set' },
      { question: "Pays de l'est<br>parfois à l'WEST<br>trouvez-moi au Sud-Est<br>à 1,5 mètre.", reponse: 'Germany' },
      { question: "Trouvez l'oeil venu du froid<br>iris de métal<br>en son reflet il pose fièrement<br>En tout temps et toutes saisons", reponse: 'Oiseau' },
      { question: "Nous sommes deux fleurs sans couleurs<br>regarde nous de près <br>d'encore plus près<br>et complète le 100%", reponse: 'Danger' }
    ];

    // Énigme finale (créée seulement quand 10/10 sont résolues)
    const finalEnigma = {
      question: "PHARE<br>LAIT<br>ZERO<br>BALANCE<br>GERMANY<br>TOUCAN<br>THONIER<br>OISEAU<br>SET<br>DANGER<br>1 2 3 7 6 1 2 4 1 5",
      reponse: 'Parenthèse'
    };

    const wrapper = document.getElementById('swiper-wrapper');

    // Helpers progression
    function areAllSolvedFirst10() {
      for (let i = 0; i < data.length; i++) {
        if (!localStorage.getItem('enigme' + i)) return false;
      }
      return true;
    }
    function createFinalSlideIfNeeded() {
      if (finalCreated) return;
      buildEnigme(finalEnigma, data.length, true);
      finalCreated = true;
      swiper.update();
    }
    function teleportToFinalWithFade() {
      const blackout = document.getElementById('blackout');
      blackout.style.opacity = 1;                // fondu vers noir (5s)
      setTimeout(() => {
        swiper.slideTo(data.length);             // aller à la finale (index = 10)
        stopSlideshow();                         // couper le diaporama
        bgContainer.innerHTML = "";              // retirer les <img> de fond (fond noir pur)
        blackout.style.opacity = 0;              // réapparition (5s)
      }, 5000);
    }
    function maybeUnlockFinal(teleport = false) {
      if (!areAllSolvedFirst10()) return;
      createFinalSlideIfNeeded();
      if (teleport) teleportToFinalWithFade();
    }

    // Construction d'une slide d'énigme
    function buildEnigme(enigme, idx, isFinal = false) {
      const slide = document.createElement('div');
      slide.classList.add('swiper-slide');
      if (isFinal) slide.classList.add('final-slide'); // fond noir

      const content = document.createElement('div');
      slide.appendChild(content);

      const q = document.createElement('div');
      q.className = 'enigme';
      q.innerHTML = enigme.question;
      content.appendChild(q);

      const input = document.createElement('input');
      input.type = 'text';
      input.id = 'input-' + idx;
      content.appendChild(input);

      const button = document.createElement('button');
      button.innerText = 'Valider';
      content.appendChild(button);

      const result = document.createElement('div');
      result.style.fontSize = "2rem";
      result.style.marginTop = "20px";
      content.appendChild(result);

      const saved = localStorage.getItem('enigme' + idx);
      if (saved) {
        q.style.display = 'none';
        input.style.display = 'none';
        button.style.display = 'none';
        result.innerHTML = `La bonne réponse est bien<br><strong>${saved}</strong>`;
      }

      button.addEventListener('click', () => {
        if (input.value.trim().toLowerCase() === enigme.reponse.toLowerCase()) {
          localStorage.setItem('enigme' + idx, input.value.trim());
          q.classList.add('fade-out');
          input.classList.add('fade-out');
          button.classList.add('fade-out');

          setTimeout(() => {
            q.style.display = 'none';
            input.style.display = 'none';
            button.style.display = 'none';
            result.innerHTML = `La bonne réponse est bien<br><strong>${enigme.reponse}</strong>`;
          }, 5000);

          // Si cette validation complète les 10/10 -> débloque et téléporte
          setTimeout(() => {
            maybeUnlockFinal(true);
          }, 1000);
        } else {
          alert('Mauvaise réponse');
        }
      });

      wrapper.appendChild(slide);
    }

    // Générer les 10 premières énigmes
    data.forEach((enigme, idx) => buildEnigme(enigme, idx));

    // Init Swiper
    swiper = new Swiper('.swiper', {
      direction: 'vertical',
      pagination: { el: '.swiper-pagination', clickable: true },
      mousewheel: true,
      keyboard: true
    });

    // Fond figé pour la 4e énigme (index 3)
    swiper.on('slideChange', () => {
      const idx = swiper.activeIndex;
      if (idx === 3) {
        setStaticBackground(specialFourthURL);   // figer sur panneaux3.jpg
      } else if (!finalCreated) {
        startSlideshow();                        // reprendre le diaporama (tant que la finale n'existe pas)
      }
    });

    // Si le joueur revient avec 10/10 déjà résolues, générer la finale (sans téléport auto)
    if (areAllSolvedFirst10()) {
      createFinalSlideIfNeeded();
    }

    // --- DEBUG optionnel : tester les images du diaporama dans la console ---
    // function testerImages(images) {
    //   images.forEach(url => {
    //     const img = new Image();
    //     img.onload = () => console.log("✅ OK :", url);
    //     img.onerror = () => console.error("❌ Introuvable :", url);
    //     img.src = url;
    //   });
    // }
    // testerImages(slideshowImages);
  </script>
</body>
</html>
